<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rental Smart Contract</title>
    <link rel="stylesheet" href="styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>Rental Smart Contract</h1>
        <p>Decentralized Rental Agreement Management</p>
      </div>

      <div class="nav-tabs">
        <button class="nav-tab active" onclick="showPage('main')">
          Dashboard
        </button>
        <button class="nav-tab" onclick="showPage('settings')">Settings</button>
      </div>

      <div id="mainPage" class="page active">
        <div class="card connect-section">
          <h2>Connect Wallet</h2>
          <button class="btn" id="connectBtn" onclick="connectWallet()">
            Connect MetaMask
          </button>
          <div
            id="accountDisplay"
            class="account-display"
            style="display: none"
          ></div>
          <div
            id="userRole"
            style="display: none; text-align: center; margin-top: 10px"
          ></div>
        </div>

        <div class="card" id="statusCard" style="display: none">
          <h2>Contract Status</h2>
          <div class="status-grid" id="contractStatus">
            <div class="loading">
              <div class="spinner"></div>
              <p>Loading contract data...</p>
            </div>
          </div>
        </div>

        <div class="card" id="signCard" style="display: none">
          <h2>Sign Rental Agreement</h2>
          <p style="color: #666; margin-bottom: 20px" id="signMessage">
            You need to sign this rental agreement to proceed. Choose your role:
          </p>
          <div class="actions-grid" id="signButtons">
            <button class="btn btn-success" onclick="signAsTenant()">
              Sign as Tenant
            </button>
            <button class="btn btn-success" onclick="signAsManager()">
              Sign as Property Manager
            </button>
          </div>
          <div id="resignButtons" style="display: none">
            <button
              class="btn btn-success btn-large"
              id="resignButton"
              onclick="resignContract()"
            >
              Re-sign Contract
            </button>
          </div>
        </div>

        <div class="card" id="tenantCard" style="display: none">
          <h2>Tenant Actions</h2>

          <div id="depositSection" style="display: none">
            <h3 style="color: #666; margin-bottom: 15px">Security Deposit</h3>
            <p style="color: #666; margin-bottom: 15px">
              You must pay the security deposit to activate the contract.
            </p>
            <button class="btn btn-success btn-large" onclick="payDeposit()">
              Pay Security Deposit (<span id="depositAmount">0</span> ETH)
            </button>
            <div class="section-divider"></div>
          </div>

          <h3 style="color: #666; margin-bottom: 15px">Monthly Rent</h3>
          <button class="btn btn-secondary btn-large" onclick="payRent()">
            Pay Rent (<span id="rentAmount">0</span> ETH)
          </button>

          <div class="section-divider"></div>

          <h3 style="color: #666; margin-bottom: 15px">Other Actions</h3>
          <div class="actions-grid">
            <button class="btn" onclick="withdraw()">Withdraw Balance</button>
            <button class="btn btn-warning" onclick="terminateContract()">
              Terminate Contract
            </button>
            <button
              class="btn btn-secondary"
              onclick="leaveContract()"
              id="leaveTenantBtn"
              style="display: none"
            >
              Leave Contract
            </button>
          </div>
        </div>

        <div class="card" id="managerCard" style="display: none">
          <h2>Property Manager Actions</h2>
          <div class="actions-grid">
            <button class="btn btn-secondary" onclick="withdraw()">
              Withdraw Balance
            </button>
            <button class="btn btn-warning" onclick="terminateContract()">
              Terminate Contract
            </button>
            <button
              class="btn btn-secondary"
              onclick="leaveContract()"
              id="leaveManagerBtn"
              style="display: none"
            >
              Leave Contract
            </button>
          </div>
        </div>

        <div class="card" id="landlordCard" style="display: none">
          <h2>Landlord Actions</h2>

          <div
            id="landlordSignSection"
            style="display: none; margin-bottom: 20px"
          >
            <h3 style="color: #666; margin-bottom: 15px">
              No Property Manager
            </h3>
            <p style="color: #666; margin-bottom: 15px">
              You can sign as the property manager to manage this property
              yourself.
            </p>
            <button class="btn btn-success" onclick="signAsManager()">
              Sign as Property Manager
            </button>
            <div class="section-divider"></div>
          </div>

          <h3 style="color: #666; margin-bottom: 15px">Deposit Management</h3>
          <div class="actions-grid">
            <button class="btn btn-warning" onclick="claimDamages()">
              Claim Damages
            </button>
            <button class="btn btn-success" onclick="returnDeposit()">
              Return Deposit
            </button>
          </div>

          <div class="section-divider"></div>

          <h3 style="color: #666; margin-bottom: 15px">Contract Management</h3>
          <div class="actions-grid">
            <button class="btn" onclick="withdraw()">Withdraw Balance</button>
            <button class="btn btn-warning" onclick="terminateContract()">
              Terminate Contract
            </button>
          </div>
        </div>

        <div class="card" id="balanceCard" style="display: none">
          <h2>Your Balance in Contract</h2>
          <div class="balance-card">
            <div>Available to Withdraw</div>
            <div class="balance-amount" id="balance">0 ETH</div>
            <button class="btn" onclick="withdraw()">Withdraw Balance</button>
          </div>
        </div>

        <div class="card landlord-only" id="termsCard" style="display: none">
          <h2>Change Contract Terms</h2>
          <p style="color: #666; margin-bottom: 15px">
            <strong>Note:</strong> Contract must be terminated before changing
            terms. All parties must re-sign after changes.
          </p>

          <div class="terms-editor">
            <div class="terms-grid">
              <div class="term-input">
                <label>Rent Cost (ETH)</label>
                <input
                  type="number"
                  id="newRentCost"
                  step="0.01"
                  placeholder="1.5"
                />
                <button
                  class="btn btn-small"
                  style="margin-top: 10px"
                  onclick="changeRentCost()"
                >
                  Update Rent
                </button>
              </div>

              <div class="term-input">
                <label>Security Deposit (ETH)</label>
                <input
                  type="number"
                  id="newDeposit"
                  step="0.01"
                  placeholder="3.0"
                />
                <button
                  class="btn btn-small"
                  style="margin-top: 10px"
                  onclick="changeDeposit()"
                >
                  Update Deposit
                </button>
              </div>

              <div class="term-input">
                <label>Management Fee (%)</label>
                <input
                  type="number"
                  id="newManagementFee"
                  min="0"
                  max="100"
                  placeholder="10"
                />
                <button
                  class="btn btn-small"
                  style="margin-top: 10px"
                  onclick="changeManagementFee()"
                >
                  Update Fee
                </button>
              </div>

              <div class="term-input">
                <label>Start Date</label>
                <input type="datetime-local" id="newStartDate" />
                <button
                  class="btn btn-small"
                  style="margin-top: 10px"
                  onclick="changeStartDate()"
                >
                  Update Start
                </button>
              </div>

              <div class="term-input">
                <label>End Date</label>
                <input type="datetime-local" id="newEndDate" />
                <button
                  class="btn btn-small"
                  style="margin-top: 10px"
                  onclick="changeEndDate()"
                >
                  Update End
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="card" id="historyCard" style="display: none">
          <h2>Payment History</h2>
          <div id="paymentHistory">
            <p class="loading">No payments yet</p>
          </div>
        </div>
        <div id="message" class="message"></div>
      </div>

      <div id="settingsPage" class="page">
        <div class="card">
          <h2>Contract Configuration</h2>
          <p style="color: #666; margin-bottom: 20px">
            Configure which rental contract you want to interact with. You only
            need to do this once.
          </p>
          <div class="input-group">
            <label>Contract Address:</label>
            <input
              type="text"
              id="contractAddress"
              placeholder="0x1234567890abcdef..."
            />
            <small style="color: #666; display: block; margin-top: 5px">
              Enter the rental contract address you want to connect to
            </small>
          </div>
          <button class="btn" onclick="saveConfig()">Save Configuration</button>
          <div
            style="
              margin-top: 30px;
              padding: 20px;
              background: #f8f9fa;
              border-radius: 8px;
            "
          >
            <h3 style="color: #333; margin-bottom: 10px">
              Where to find your contract address?
            </h3>
            <ul style="color: #666; line-height: 1.8">
              <li>After deploying with Truffle, check the migration output</li>
              <li>Look in your browser console after deployment</li>
              <li>
                Check Etherscan (sepolia.etherscan.io for Sepolia testnet)
              </li>
              <li>Ask the landlord who deployed the contract</li>
            </ul>
          </div>

          <div
            style="
              margin-top: 20px;
              padding: 15px;
              background: #fff3cd;
              border-radius: 8px;
              border-left: 4px solid #ffc107;
            "
          >
            <strong style="color: #856404">Current Configuration:</strong><br />
            <span
              id="currentConfig"
              style="color: #666; font-family: monospace; word-break: break-all"
            >
              Not configured yet
            </span>
          </div>
        </div>
      </div>
    </div>

    <script src="script.js"></script>
  </body>
</html>
